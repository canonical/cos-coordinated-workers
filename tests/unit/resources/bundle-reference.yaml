# this is a sample export-bundle based on a tempo test-self-monitoring-distributed-tls model.
# For testing the cluster_consistency reusable probe

bundle: kubernetes
applications:
  graf:
    charm: grafana-k8s
    channel: 2/edge
    revision: 163
    resources:
      grafana-image: 73
      litestream-image: 46
    scale: 1
    constraints: arch=amd64
    storage:
      database: kubernetes,1,1024M
  minio:
    charm: minio
    channel: ckf-1.10/edge
    revision: 583
    base: ubuntu@20.04/stable
    resources:
      oci-image: 547
    scale: 1
    options:
      access-key: accesskey
      secret-key: secretkey
    constraints: arch=amd64
    storage:
      minio-data: kubernetes,1,10240M
    trust: true
  prometheus:
    charm: prometheus-k8s
    channel: 2/edge
    revision: 254
    resources:
      prometheus-image: 151
    scale: 1
    constraints: arch=amd64
    storage:
      database: kubernetes,1,1024M
    trust: true
  s3-integrator:
    charm: s3-integrator
    channel: 2/edge
    revision: 157
    scale: 1
    options:
      bucket: tempo
      credentials: secret:d3eh9j7mp25c767ab7qg
      endpoint: minio-0.minio-endpoints.test-self-monitoring-distributed-tls-23c7aeab.svc.cluster.local:9000
    constraints: arch=amd64
  tempo:
    charm: local:tempo-coordinator-k8s-0
    scale: 1
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
  tempo-worker-compactor:
    charm: local:tempo-worker-k8s-4
    scale: 1
    options:
      role-all: false
      role-compactor: true
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
  tempo-worker-distributor:
    charm: local:tempo-worker-k8s-3
    scale: 1
    options:
      role-all: false
      role-distributor: true
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
  tempo-worker-ingester:
    charm: local:tempo-worker-k8s-2
    scale: 3
    options:
      role-all: false
      role-ingester: true
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
  tempo-worker-metrics-generator:
    charm: local:tempo-worker-k8s-5
    scale: 1
    options:
      role-all: false
      role-metrics-generator: true
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
  tempo-worker-querier:
    charm: local:tempo-worker-k8s-0
    scale: 1
    options:
      role-all: false
      role-querier: true
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
  tempo-worker-query-frontend:
    charm: local:tempo-worker-k8s-1
    scale: 1
    options:
      role-all: false
      role-query-frontend: true
    constraints: arch=amd64
    storage:
      data: kubernetes,1,1024M
    trust: true
relations:
- - tempo:tempo-cluster
  - tempo-worker-querier:tempo-cluster
- - tempo:tempo-cluster
  - tempo-worker-query-frontend:tempo-cluster
- - tempo:tempo-cluster
  - tempo-worker-ingester:tempo-cluster
- - tempo:tempo-cluster
  - tempo-worker-distributor:tempo-cluster
- - tempo:tempo-cluster
  - tempo-worker-compactor:tempo-cluster
- - tempo:tempo-cluster
  - tempo-worker-metrics-generator:tempo-cluster
- - prometheus:receive-remote-write
  - tempo:send-remote-write
- - tempo:s3
  - s3-integrator:s3-credentials